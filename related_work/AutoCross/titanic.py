import sys
sys.path.append('C:\\Users\\ZFY\\PycharmProjects\\AutoFE')
sys.path.append('/GPUFS/ecnu_cqjin_caipeng/AutoFE')

from utils.init_seed import init_seed
from related_work.AutoCross.beam_search.beam_search import search
from related_work.AutoCross.feature_wise.model_train import evaluation_with_auc, evaluation_with_r2
import scipy
# from dataprocessing.house_price_data import get_data
from dataprocessing import dataset

if __name__ == '__main__':
    init_seed()
    train, label = dataset.get_titanic(False)
    chosen_list = search(train, label, 15, 'class')
    print(chosen_list.keys())

    # train = scipy.sparse.csr_matrix(train.values)
    train = None
    for i in chosen_list:
        if train is None:
            train = chosen_list[i]
        else:
            train = scipy.sparse.hstack([train, chosen_list[i]])
    print(train.shape)
    print(evaluation_with_auc(train, label))

# beam search:   0%|                                                                                                                                                                                                                                     | 0/15 [00:00<?, ?it/s]83.30361085218074
# beam search:   7%|██████████████▋                                                                                                                                                                                                              | 1/15 [00:01<00:15,  1.13s/it]84.89635526763921
# beam search:  13%|█████████████████████████████▍                                                                                                                                                                                               | 2/15 [00:02<00:15,  1.21s/it]85.8830077920859
# beam search:  20%|████████████████████████████████████████████▏                                                                                                                                                                                | 3/15 [00:04<00:16,  1.35s/it]86.43339131714623
# beam search:  27%|██████████████████████████████████████████████████████████▉                                                                                                                                                                  | 4/15 [00:06<00:17,  1.56s/it]86.81168912428446
# beam search:  33%|█████████████████████████████████████████████████████████████████████████▋                                                                                                                                                   | 5/15 [00:08<00:18,  1.84s/it]87.02201465131145
# beam search:  40%|████████████████████████████████████████████████████████████████████████████████████████▍                                                                                                                                    | 6/15 [00:11<00:20,  2.23s/it]87.28131748039536
# beam search:  47%|███████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                                     | 7/15 [00:16<00:24,  3.05s/it]87.4372658516937
# beam search:  53%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                       | 8/15 [00:23<00:28,  4.02s/it]87.57258677485572
# beam search:  60%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                        | 9/15 [00:32<00:33,  5.62s/it]87.74052154857664
# beam search:  67%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                         | 10/15 [00:49<00:45,  9.08s/it]87.78071240099912
# beam search:  73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                          | 11/15 [01:22<01:04, 16.17s/it]87.77843784284573
# beam search:  80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                            | 12/15 [02:30<01:35, 31.80s/it]87.76341537811774
# beam search:  87%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                             | 13/15 [04:43<02:04, 62.17s/it]87.82738883710282
# beam search:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍              | 14/15 [11:25<02:43, 163.96s/it]87.7979927148725
# beam search: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [28:21<00:00, 419.57s/it]
# dict_keys(['Pclass___Sex', 'Sex___Fare__3___Pclass', 'Fare__2___Embarked', 'Sex___Age___Pclass', 'Parch___Embarked', 'Sex___SibSp', 'Fare__3___Embarked___Parch___Sex___Pclass', 'Pclass___Embarked', 'Pclass___Fare__3', 'Sex___Fare__2', 'Fare__1___Fare__2___Embarked', 'PassengerId__2___Fare__3', 'Fare__3___Fare__1___Pclass', 'Fare__3___Embarked', 'PassengerId__2___Embarked___Pclass'])
# (891, 2135)
# 87.7979927148725