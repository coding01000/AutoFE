import sys
sys.path.append('C:\\Users\\ZFY\\PycharmProjects\\AutoFE')
sys.path.append('/GPUFS/ecnu_cqjin_caipeng/AutoFE')

from utils.init_seed import init_seed
from related_work.AutoCross.beam_search.beam_search import search
from related_work.AutoCross.feature_wise.model_train import evaluation_with_auc, evaluation_with_r2
import scipy
# from dataprocessing.house_price_data import get_data
from dataprocessing import dataset

if __name__ == '__main__':
    init_seed()
    train, label = dataset.get_bike_share(False)
    chosen_list = search(train, label, 12, 'regress')
    print(chosen_list.keys())

    # train = scipy.sparse.csr_matrix(train.values)
    train = None
    for i in chosen_list:
        if train is None:
            train = chosen_list[i]
        else:
            train = scipy.sparse.hstack([train, chosen_list[i]])
    print(train.shape)
    print(evaluation_with_r2(train, label))


# beam search:   0%|                                                                                                                                                                                                                                     | 0/15 [00:00<?, ?it/s]22.915163821168576
# beam search:   7%|██████████████▋                                                                                                                                                                                                              | 1/15 [00:22<05:17, 22.71s/it]34.021827254969025
# beam search:  13%|█████████████████████████████▍                                                                                                                                                                                               | 2/15 [03:30<15:39, 72.23s/it]34.43159551982363
# beam search:  20%|████████████████████████████████████████████                                                                                                                                                                                | 3/15 [06:29<20:51, 104.30s/it]34.64510690652061
# beam search:  27%|██████████████████████████████████████████████████████████▋                                                                                                                                                                 | 4/15 [09:55<24:43, 134.90s/it]34.364489381710165
# beam search:  33%|█████████████████████████████████████████████████████████████████████████▎                                                                                                                                                  | 5/15 [16:55<36:44, 220.41s/it]34.45488350842999
# beam search:  40%|████████████████████████████████████████████████████████████████████████████████████████                                                                                                                                    | 6/15 [26:08<48:01, 320.15s/it]34.699951066097675
# beam search:  47%|██████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                     | 7/15 [37:35<57:19, 430.00s/it]34.30916570070082
# beam search:  53%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                                     | 8/15 [52:54<1:07:18, 576.96s/it]34.30143682899579
# beam search:  60%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                      | 9/15 [1:11:09<1:13:14, 732.38s/it]33.925788979104475
# beam search:  67%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                       | 10/15 [1:38:53<1:24:18, 1011.80s/it]34.1890237082001
# beam search:  73%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                         | 11/15 [2:17:14<1:33:13, 1398.47s/it]34.51030131723184
# beam search:  80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                          | 12/15 [3:04:16<1:31:16, 1825.56s/it]34.47399155189741
# beam search:  87%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 13/15 [3:53:29<1:12:07, 2163.79s/it]34.2712909252099
# beam search:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌              | 14/15 [4:51:18<42:35, 2555.41s/it]34.14843515273361
# beam search: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [5:49:24<00:00, 2834.38s/it]
# dict_keys(['datetime___temp', 'workingday___temp', 'holiday___workingday', 'temp___datetime___workingday', 'temp___holiday___datetime', 'temp___holiday___datetime___workingday', 'holiday___temp'])
# (10886, 6186)
# 33.699159021615884